<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>txGenerator 1.0</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  </head>
  <body style="background-color: gray;">
    <!-- <h1>Hello World!</h1> -->
    <!-- All of the Node.js APIs are available in this renderer process. -->
    <!-- We are using Node.js <script>document.write(process.versions.node)</script>, -->
    <!-- Chromium <script>document.write(process.versions.chrome)</script>, -->
    <!-- and Electron <script>document.write(process.versions.electron)</script>. -->
    <div class="pt-2 pl-5 pr-5">
      <div id="alert" class="alert alert-primary alert-dismissible mt-2" style="display:none;" role="alert">
        <strong>Notice!</strong> Your client is connected with Blockchain network.
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class = "row mt-3">
        <div class = "col-md-3">
          <span style="color:white;">Sender Address : </span>
        </div>
        <div class = "col-md-9">
          <input id="sender" type="text" style="width: 100%" disabled/>
        </div>
      </div>

      <div class = "row mt-2">
        <div class = "col-md-3">
            <span style="color:white;">Receiver Address : </span>
        </div>
        <div class = "col-md-9">
          <input id="receiver" type="text" style="width: 100%" disabled/>
        </div>
      </div>
      
      <div class = "row mt-2">
        <div class = "col-md-3">
            <span style="color:white;"> Sending Amount : </span>
        </div>
        <div class = "col-md-9">
          <input id="amount" type="number" step="0.00000001" style="width: 100%" disabled/>
          <span style="position: absolute;top:3px;right:35px;">BTC</span>
        </div>
      </div>

      <div class = "row mt-4">
        <!-- controllers -->
        <div class = "col-md-4 text-center">
          <button id="genTrans" type="button" class="btn btn-secondary" disabled>Generate Transaction</button>
        </div>
        <div class = "col-md-4 text-center">
          <button id="broadTrans" type="button" class="btn btn-secondary" disabled>Broadcast Transaction</button>
        </div>
        <div class = "col-md-4 text-center">
          <button id="clearTrans" type="button" class="btn btn-secondary">Clear Terminal Log</button>
        </div>
      </div>

      <div class = "row mt-4">
        <div class="col-md-12">
          <span style="color:white;">Terminal</span>
          <div id="terminal"></div>
        </div>
      </div>

    </div>

    <script>

      $( document ).ready(function() {
        // /starts a new line |delays
        var string = ">BOOT STARTUP SYSTEM INITIALISING.|..|...|....|...../>STARTUP OK./>NETWORK COONNECTION.|...|.....|.....GOOD./>CONNECTED.|/>";
        
        var fString = "";
        var progress = 0; 
        var badString= "";
        var m_case = 1;
        var blinker = false;
        var tx_id = "010000000175f47f33c814a43bd048368e7f973e42d1fb891f19a9c98fe9c93f263e276670010000006b483045022100ea5eff44ad226e1935c9efebf6e5261564c88611ec4a034d1c75a901fc5c71c302200ee0c48f9c63898c5b8f2937564a11e60f880d1fa3f5644ee39af85c62dcc534012103b80c696a1f6b8e5efbd56f778e5a92220bac1eca86f9e77ce21173fbc1d6f616ffffffff0210270000000000001976a91499bc78ba577a95a11f1a344d4d2ae55f2f857b9888ac24237200000000001976a914c3e35358a793f10cc8465dd64c28ca2fd79b4df188ac00000000"
                 
        blink = function(){
            blinker?$('#terminal').html(fString):$('#terminal').html(fString+"_")
            blinker=!blinker;
        }; 
        
        var pause = function(){
          var setBlink = setInterval(function(){blink();}, 500);
          setTimeout(function(){step1(); clearInterval(setBlink);}, 1000);
        };
        
        var step1 = function(){
          if(progress<string.length){
          var next = string.substring(progress,progress+1);
          switch(next){
            case "|": pause(); break;
            case "/": fString+="<p>"; setTimeout(function(){step1()},100);  break;
            default: fString+=next;
              $('#terminal').html(fString+"_"); 
              setTimeout(function(){step1()}, 50 + Math.random()*100); 
              break;
            }
          progress++;
          }
          //else{setInterval(function(){blink();}, 500);}
          else{
            $("#genTrans").prop('disabled', false);
            $("#sender").prop('disabled', false);
            $("#receiver").prop('disabled', false);
            $("#amount").prop('disabled', false);
            $("#alert").show();
          }
        };
        var step2 = function(){
          $('#terminal').animate({scrollTop:$('#terminal').height()}, 1000);

          if(progress<string.length){
          var next = string.substring(progress,progress+1);
          switch(next){
            case "|": 
              var setBlink = setInterval(function(){blink();}, 500);
              setTimeout(function(){step2(); clearInterval(setBlink);}, 1000); 
              break;
            case "/": 
                fString+="<p>"; setTimeout(function(){step2()},100);  break;
            case '(' :
                m_case = 2;
                fString+="<span style='color:grey;'>";
                setTimeout(function(){step2()},100);
                break;
            case ')' :
                m_case = 1;
                fString+="</span>";
                setTimeout(function(){step2()},100);
                break;
            default: 
              fString+=next;
              $('#terminal').html(fString+"_"); 
              if (m_case == 1) setTimeout(function(){step2()}, 50 + Math.random()*100); 
              if (m_case == 2) setTimeout(function(){step2()}, 10 + Math.random()*10); 
              break;
            }
          progress++;
          }
          else{
            $("#broadTrans").prop('disabled', false);
            $("#alert").html('<strong>Great!</strong> Transaction is created! <br><span><div style="width:100%;word-wrap:break-word;display:block"> tx : ' + tx_id +'</div></span><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>')
            $("#alert").show();
          }
        };
        
        step1();

        $("#genTrans").click(function(){
            var passStr = ""
            var count = 0;
            var phraseStr = "0123456789abcdef"
            while(passStr.length<1350){
              passStr+= phraseStr.charAt(Math.floor(Math.random()*15))
              count++;
            }

            string += "GENERATE TRANSACTION ON BLOCKCHAIN...|...../(" + passStr + ")/..|....|/>TRANSACTION GENERATED./>...Ready to Broadcast!/>"

            step2();
        }); 

        $("#broadTrans").click(function(){
            alert("Failed to broadcast transaction!");
        });

        $("#clearTrans").click(function(){
            alert("button");
        });

      });

      require('./renderer.js')
    </script>
  </body>
</html>
